# Changelog - Migration to aiogram 3.x

## –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –≤–µ—Ä—Å–∏–∏ 3.x

### ‚ú® –û–±–Ω–æ–≤–ª–µ–Ω–æ

#### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- `aiogram`: 2.14 ‚Üí 3.15
- `environs`: 8.0.0 ‚Üí 11.0.0
- –î–æ–±–∞–≤–ª–µ–Ω–æ: `cachetools` 5.3.0

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ–∞–π–ª—ã

**loader.py**
- –ù–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç: `DefaultBotProperties`, `ParseMode`
- –ò–∑–º–µ–Ω–µ–Ω–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Dispatcher
- Bot —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `DefaultBotProperties` –¥–ª—è parse_mode

**app.py**
- –ó–∞–º–µ–Ω–µ–Ω `executor.start_polling()` –Ω–∞ `asyncio.run(main())`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ —Ä–æ—É—Ç–µ—Ä–æ–≤ —á–µ—Ä–µ–∑ `dp.include_router()`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ middlewares —á–µ—Ä–µ–∑ `setup_middlewares()`
- –£–ª—É—á—à–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

**handlers/users/start.py**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `Router` –≤–º–µ—Å—Ç–æ –ø—Ä—è–º–æ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ `dp`
- –§–∏–ª—å—Ç—Ä: `CommandStart()` —Å –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–º `@router.message()`

**handlers/users/help.py**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `Router`
- –§–∏–ª—å—Ç—Ä: `Command("help")`

**handlers/users/echo.py**
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `Router`
- –§–∏–ª—å—Ç—Ä: `F.text` –≤–º–µ—Å—Ç–æ `state=None`

**handlers/__init__.py**
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `setup_routers()` –¥–ª—è —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–æ—É—Ç–µ—Ä–∞–º–∏

**middlewares/throttling.py**
- –ü–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –ø–æ–¥ –Ω–æ–≤—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É BaseMiddleware
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `cachetools.TTLCache` –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è

**handlers/errors/error_handler.py**
- –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –ù–æ–≤—ã–π –∫–ª–∞—Å—Å –∏—Å–∫–ª—é—á–µ–Ω–∏–π –∏–∑ `aiogram.exceptions`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `ErrorEvent` –≤–º–µ—Å—Ç–æ `update, exception`

**utils/set_bot_commands.py**
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `Bot` –≤–º–µ—Å—Ç–æ `Dispatcher`
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ `BotCommand`

**utils/notify_admins.py**
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç `Bot` –≤–º–µ—Å—Ç–æ `Dispatcher`

### üìù –î–æ–±–∞–≤–ª–µ–Ω–æ

- `README.md` - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- `MIGRATION_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- `CHANGELOG.md` - —ç—Ç–æ—Ç —Ñ–∞–π–ª
- `.env.example` - –ø—Ä–∏–º–µ—Ä —Ñ–∞–π–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### üîÑ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

1. **Router-based –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞**: –∫–∞–∂–¥—ã–π –º–æ–¥—É–ª—å handler'–æ–≤ —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≤–æ–π Router
2. **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–æ—É—Ç–µ—Ä–æ–≤**: —á–µ—Ä–µ–∑ `setup_routers()` –≤ handlers/__init__.py
3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –Ω–æ–≤—ã–µ –∫–ª–∞—Å—Å—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π aiogram 3.x
4. **–ú–æ–¥—É–ª—å–Ω—ã–µ middlewares**: setup —á–µ—Ä–µ–∑ —Ñ—É–Ω–∫—Ü–∏—é `setup_middlewares()`

### ‚ö†Ô∏è Breaking Changes

- –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã `@dp.message_handler()` –∑–∞–º–µ–Ω–µ–Ω—ã –Ω–∞ `@router.message()`
- `executor.start_polling()` –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ `asyncio.run()` + `dp.start_polling(bot)`
- –ò–∑–º–µ–Ω–µ–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ middlewares
- –ò–∑–º–µ–Ω–µ–Ω—ã –∏–º–ø–æ—Ä—Ç—ã –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- Dispatcher –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç bot –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ

### üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –≤–µ—Ä—Å–∏–∏

- –ë–æ–ª–µ–µ —á–∏—Å—Ç–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–æ—É—Ç–µ—Ä–∞–º–∏
- –õ—É—á—à–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- –ë–æ–ª–µ–µ –≥–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ middlewares
- –ê–∫—Ç—É–∞–ª—å–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –æ—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤
